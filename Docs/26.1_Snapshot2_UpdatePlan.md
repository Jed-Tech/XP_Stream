# Minecraft 26.1 Snapshot 2 Update Plan

## Overview

This document outlines the plan to update XP_Stream from Minecraft 1.21.11 to **Minecraft 26.1 Snapshot 2** for both Fabric and NeoForge loaders.

**Target Version:** Minecraft 26.1 Snapshot 2  
**Current Version:** Minecraft 1.21.11  
**Java Requirement:** Java 25 (upgrade from Java 21)

---

## Critical Changes Summary

### Java Version
- **Current:** Java 21
- **Required:** Java 25
- **Impact:** Must update Gradle toolchain + `--release`, and ensure the IDE/Gradle JVM + run configs are actually using Java 25 (not just compiling against it).

### Minecraft code/mappings reality (26.1+)
- **Minecraft 26.1+ builds are unobfuscated/deobfuscated**, which changes the usual “mapping + remap” expectations across toolchains.
- **Practical action:** **migrate Fabric source from Yarn → Mojang mappings while still on 1.21.11**, then port to 26.1 snapshots. Fabric explicitly recommends this because Yarn won’t be available after 1.21.11.

### Fabric (key constraints)
- **Mappings strategy:** Do **not** try to jump straight from Yarn → 26.1 in one step; use the Phase 0 migration.
- **Gradle plugin ID:** Use `net.fabricmc.fabric-loom` for 26.1+ unobfuscated versions (verify exact guidance in Fabric docs for the specific Loom version you pin).
- **Dependency configurations:** Keep Loom’s augmented configurations for mod dependencies: `modImplementation` / `modApi` / `modRuntimeOnly` etc. (Do not replace with plain `implementation` unless you’ve confirmed it’s not a mod dep.)
- **Toolchain versions:** Do not guess. Pin **current** Fabric Loader (0.18.x line as of current releases) and a Loom version explicitly documented as compatible with 26.1+ unobfuscated builds.

### NeoForge Changes
- **Snapshot 2 version:** `26.1.0.0-alpha.5+snapshot-2`
- **ModDevGradle:** Snapshot builds are supported starting **ModDevGradle 2.0.134** (you’re currently on 2.0.134; verify if NeoForge recommends newer for snapshot-2).
- **Mappings / Parchment:** Parchment is **not required** now that parameter names are available; optionally keep it only if you want extra docs/Javadocs.
- **Java:** Must support Java 25

---

## Step-by-Step Update Plan

### Phase 0: Pre-port mapping migration (do this on 1.21.11)

**Goal:** Convert the Fabric side of the codebase from **Yarn mappings → Mojang mappings** while staying on Minecraft **1.21.11**, so the later 26.1 snapshot port is “just” an API/version bump.

- **Note:** NeoForge already uses Mojang mappings; **no mapping migration is required on that side**.

- [ ] Create a short-lived branch for the mapping migration (or do it as the first commit on the main update branch).
- [ ] Switch the Fabric dev environment from Yarn → Mojang mappings.
  - Use Loom’s `migrateMappings` task **or** the Ravel IDE plugin (per Fabric docs).
- [ ] Manually review/fix **mixins** after migration (expect breakage).
  - Your Fabric mixin currently targets Yarn names like `ExperienceOrbEntity` and `onPlayerCollision`; after migration these should converge toward Mojmap names (closer to your NeoForge mixin).
- [ ] Build + run on **1.21.11** to confirm behavior unchanged (functional parity before porting).
- [ ] Commit this as an isolated, reviewable commit (“Fabric: migrate Yarn → Mojang mappings on 1.21.11”).

**Phase 0 Exit Criteria:** Fabric + NeoForge both build and run on 1.21.11 using Mojang mappings, with identical XP behavior and no mixin warnings.

### Phase 1: Pre-Update Preparation

#### 1.1 Verify Java 25 Availability
- [ ] Confirm Java 25 is installed in development environment
- [ ] Update IDE (IntelliJ IDEA 2025.3+ recommended for full Java 25 support)
- [ ] Verify `JAVA_HOME` points to Java 25
- [ ] Verify Gradle is running on Java 25 (Gradle JVM) and your run configs use Java 25

#### 1.2 Backup Current State
- [ ] Create a git branch: `git checkout -b update/26.1-snapshot-2`
- [ ] Commit current working state
- [ ] Document current versions in a backup file

#### 1.3 Research Exact Versions
- [ ] Confirm NeoForge snapshot-2 version string: `26.1.0.0-alpha.5+snapshot-2`
- [ ] Pull **current** Fabric Loader + Loom versions from official sources (Fabric release pages + Fabric docs for 26.1/unobfuscated guidance), then pin them in `gradle.properties`.
- [ ] Read Snapshot 1 + Snapshot 2 release notes for breaking changes relevant to mixins/entity behavior and runtime/perf expectations.
- [ ] Check for breaking changes in the loader toolchains (Fabric Loom + MDG) that affect build/publishing tasks (e.g., whether `remapJar` still exists/should be used).

---

### Phase 2: Update Gradle Configuration

#### 2.1 Update Root `build.gradle`
- [ ] Update Java toolchain from 21 to 25:
  ```groovy
  java {
      toolchain {
          languageVersion = JavaLanguageVersion.of(25)
      }
  }
  ```
- [ ] Update `options.release = 25`

#### 2.2 Update `gradle.properties`
- [ ] Update `minecraft_version` to the 26.1 snapshot-2 identifier used by your toolchains (this may be a “26.1 snapshot” string rather than a `1.xx`).
- [ ] The snapshot identifier may differ slightly between Fabric and NeoForge (e.g., `26.1-snapshot-2` vs loader-specific snapshot coordinates). Always follow loader docs.
- [ ] **After Phase 0**, remove/stop using `yarn_mappings` and switch the Fabric module to Mojang mappings configuration.
- [ ] Update `fabric_loader_version` to a **current** compatible release (0.18.x line as of current releases).
- [ ] Update `fabric_loom_version` to the Loom version documented as compatible with 26.1+ unobfuscated builds.
- [ ] Set `neoforge_version=26.1.0.0-alpha.5+snapshot-2`
- [ ] Keep `moddevgradle_version >= 2.0.134`; bump if NeoForge recommends a newer MDG for snapshot-2.

---

### Phase 3: Update Fabric Module

#### 3.1 Update `fabric/build.gradle`
- [ ] Change Loom plugin ID:
  ```groovy
  id 'net.fabricmc.fabric-loom' version "${fabric_loom_version}"
  ```
  (from `id 'fabric-loom'`)
- [ ] **Mappings:** Configure Fabric to use **official Mojang mappings** (this should already be done by Phase 0; don’t do it for the first time during the 26.1 bump).
- [ ] **Do not change** Loom mod dependency configurations:
  - Keep `modImplementation` / `modApi` / `modRuntimeOnly` etc. for mod deps (these configurations are part of Loom’s remap/jij handling).
- [ ] **Build/publish tasks:** Verify what Loom generates for 26.1 unobfuscated:
  - Confirm whether `remapJar` is still produced/expected, or whether publishing should use `jar` (or another Loom production task). Don’t assume.

#### 3.2 Update `fabric/src/main/resources/fabric.mod.json`
- [ ] Update `minecraft` dependency version:
  ```json
  "minecraft": "26.1-snapshot-2"
  ```
- [ ] Update `fabricloader` version requirement:
  ```json
  "fabricloader": ">=0.18.0"
  ```

#### 3.3 Update Mixin Configuration
- [ ] Update `fabric/src/main/resources/xp_stream.fabric.mixins.json`:
  - Verify what `compatibilityLevel` value is supported by the Sponge Mixin version bundled with your toolchain. (Don’t blindly set `"JAVA_25"` unless confirmed; some toolchains keep `"JAVA_21"` even when compiling with newer Java.)

#### 3.4 Code Updates (if needed)
- [ ] Review `ExperienceOrbEntityMixin.java` for mapping changes
  - Method name `onPlayerCollision` may have changed
  - Class names may have changed (e.g., `ExperienceOrbEntity` → `ExperienceOrb`)
  - Check for API changes in `TypeFilter`, `ServerWorld`, etc.
- [ ] Test mixin target still exists and is accessible

---

### Phase 4: Update NeoForge Module

#### 4.1 Update `neoforge/build.gradle`
- [ ] Verify ModDevGradle version supports 26.1 snapshots
- [ ] Remove any Parchment mapping configuration (if present)
- [ ] Verify NeoForge version is correctly referenced

#### 4.2 Update `neoforge/src/main/resources/META-INF/neoforge.mods.toml`
- [ ] Update `minecraft_version` variable usage (should auto-update from gradle.properties)
- [ ] Update `neoforge_version` variable usage
- [ ] Verify version ranges are appropriate

#### 4.3 Update Mixin Configuration
- [ ] Update `neoforge/src/main/resources/xp_stream.neoforge.mixins.json`:
  - Verify what `compatibilityLevel` value is supported by the Sponge Mixin version bundled with your toolchain. (Don’t blindly set `"JAVA_25"` unless confirmed.)

#### 4.4 Code Updates (if needed)
- [ ] Review `ExperienceOrbMixin.java` for mapping changes
  - Method name `playerTouch` may have changed
  - Class names may have changed
  - Check for API changes in `ServerLevel`, `AABB`, etc.
- [ ] Verify field names (e.g., `player.takeXpDelay` may have changed)
- [ ] Test mixin target still exists and is accessible

---

### Phase 5: Update Common Module

#### 5.1 Review Common Code
- [ ] Check `XpStreamConfig.java` for any Java 25 compatibility issues
- [ ] Verify Gson usage is still compatible
- [ ] Check `XpStreamConstants.java` (if exists)

#### 5.2 Update Build Configuration
- [ ] Verify common module compiles with Java 25
- [ ] Ensure common module is included in both Fabric and NeoForge JARs

---

### Phase 6: Build and Test

#### 6.1 Clean Build
- [ ] Run `./gradlew clean`
- [ ] Run `./gradlew build` to verify compilation
- [ ] Fix any compilation errors

#### 6.2 Test Fabric
- [ ] Run `./gradlew :fabric:runClient` (or `:fabric:runServer`)
- [ ] Verify mod loads without errors
- [ ] Check mixin application in logs
- [ ] Test XP orb pickup functionality
- [ ] Verify config loading works
- [ ] Re-run your “200 XP orbs” perf benchmark on Java 25 (snapshot runtime defaults may shift baselines; don’t assume the old 2.5s number holds).

#### 6.3 Test NeoForge
- [ ] Run `./gradlew :neoforge:runClient` (or `:neoforge:runServer`)
- [ ] Verify mod loads without errors
- [ ] Check mixin application in logs
- [ ] Test XP orb pickup functionality
- [ ] Verify config loading works
- [ ] Re-run your “200 XP orbs” perf benchmark on Java 25 (snapshot runtime defaults may shift baselines; don’t assume the old 2.5s number holds).

#### 6.4 Cross-Platform Verification
- [ ] Compare behavior between Fabric and NeoForge
- [ ] Verify identical functionality
- [ ] Check performance characteristics match

---

### Phase 7: Documentation and Release

#### 7.1 Update Documentation
- [ ] Update `CHANGELOG.md` with 26.1 Snapshot 2 support
- [ ] Update `Docs/technicalBrief.md` with new version info
- [ ] Update version compatibility table

#### 7.2 Version Bump (if releasing)
- [ ] Consider bumping `mod_version` in `gradle.properties`
- [ ] Update JAR naming if needed

---

## Potential Issues and Mitigation

### Issue 1: Mapping Changes
**Risk:** Method/class names may have changed between 1.21.11 and 26.1 Snapshot 2  
**Mitigation:**
- Use IDE decompiled view to check actual method names
- Test mixin application in logs
- Keep Fabric and NeoForge mixins separate (already done)

### Issue 2: API Changes
**Risk:** Minecraft APIs may have changed (e.g., `TypeFilter`, entity query methods)  
**Mitigation:**
- Review release notes for breaking changes
- Test thoroughly with gameplay scenarios
- Check for deprecation warnings

### Issue 3: Java 25 Compatibility
**Risk:** Some libraries or code patterns may not work with Java 25  
**Mitigation:**
- Test compilation first
- Check for Java 25-specific warnings
- Update dependencies if needed

### Issue 4: Fabric Loom Breaking Changes
**Risk:** Updating Fabric Loom to a 26.1-compatible version may have breaking changes  
**Mitigation:**
- Follow Fabric migration guide
- Test build process thoroughly
- Check Fabric Discord/forums for known issues

---

## Verification Checklist

Before considering the update complete:

- [ ] Both Fabric and NeoForge modules compile successfully
- [ ] Both loaders can run client and server
- [ ] Mod loads without errors on both platforms
- [ ] Mixins apply successfully (check logs)
- [ ] Config file loads correctly
- [ ] XP orb burst pickup works as expected
- [ ] No XP loss occurs
- [ ] Mending compatibility preserved
- [ ] Performance re-benchmarked on Java 25 and snapshots (do not require the old “2.5s for 200 orbs” to hold exactly)
- [ ] Debug logging works (if enabled)
- [ ] No deprecation warnings in build output

---

## Rollback Plan

If issues are encountered:

1. **Git Rollback:**
   ```bash
   git checkout main
   git branch -D update/26.1-snapshot-2
   ```

2. **Restore Versions:**
   - Revert `gradle.properties` to 1.21.11 versions
   - Revert `build.gradle` Java toolchain to 21
   - Revert Fabric build.gradle changes

3. **Clean Build:**
   ```bash
   ./gradlew clean build
   ```

---

## Resources

- [Minecraft 26.1 Snapshot 1 Release Notes](https://feedback.minecraft.net/hc/en-us/articles/42011663817357-Minecraft-Java-Edition-26-1-Snapshot-1)
- [Minecraft 26.1 Snapshot 2 Release Notes](https://feedback.minecraft.net/hc/en-us/articles/42480249808653-Minecraft-Java-Edition-26-1-Snapshot-2)
- [Fabric Porting Guide](https://docs.fabricmc.net/develop/porting/next)
- [NeoForge 26.1 Snapshots Announcement](https://neoforged.net/news/26.1snapshots/)

---

## Notes

- This is a **major version jump** (1.21.11 → 26.1), expect significant changes
- Both Fabric and NeoForge have **breaking changes** in their toolchains
- **Java 25 is required** - ensure development environment is ready
- **Test thoroughly** before considering the update complete
- Consider waiting for more stable releases if snapshot support is not critical
- Snapshot 2/runtime defaults may change performance baselines; re-benchmark and adjust expectations accordingly.

---

**Plan Created:** 2025-01-XX  
**Status:** Ready for Review  
**Next Step:** Confirm Java 25 availability, then do Phase 0 (Yarn → Mojang on 1.21.11), then proceed to the 26.1 snapshot port
