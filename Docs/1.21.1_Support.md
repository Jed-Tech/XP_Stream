# 1.21.1 Long-Term Maintenance Release Plan

## Overview

This document outlines the plan for creating a one-time maintenance release of XP_Stream for Minecraft 1.21.1, targeting the modpack community's chosen LTS version. This is a **set-and-forget** release — once tested and released, no further updates are planned for this branch.

## Branch Strategy

- **Branch:** `maintenance/1.21.1`
- **Purpose:** One-time release for modpack community
- **Maintenance:** None after initial release (leave as-is)

---

## Version Research & Truth Sources

### ✅ Critical Principle: Use Official Templates as Truth Sources

**Never guess versions.** Always pull from:
- Official MDK repositories for NeoForge
- Official Fabric blog posts and release notes
- Maven repositories for exact build numbers

### Fabric 1.21.1 Versions

**Truth Sources:**
- [Fabric Maven Repository](https://maven.fabricmc.net/) for Yarn mappings
- [Fabric Blog](https://fabricmc.net/) for Loom version recommendations
- Fabric installer for Loader version (use "latest stable" pattern)

**Known Versions:**
- **Minecraft:** `1.21.1`
- **Yarn Mappings:** `1.21.1+build.1` (or `build.2`, `build.3` — verify latest)
  - Source: [FabricMC Maven](https://maven.fabricmc.net/net/fabricmc/yarn/)
- **Fabric Loom:** `1.6.x` (recommended for 1.21/1.21.1 generation)
  - Source: Fabric's 1.21/1.21.1 blog post
- **Fabric Loader:** Use exact version in `gradle.properties` (e.g., `0.16.0`, `0.16.7`, `0.17.0`)
  - **Critical:** Gradle needs exact version to resolve dependencies and run dev
  - Check current stable: [Fabric Loader Maven](https://maven.fabricmc.net/net/fabricmc/fabric-loader/)
  - Use `>=0.16.0` pattern **only in `fabric.mod.json`** (metadata), not in `gradle.properties`

**Action Items:**
- [ ] Verify latest Yarn build number for 1.21.1 (check `1.21.1+build.1`, `build.2`, `build.3`)
- [ ] Confirm exact Loom version (1.6.x series) from Fabric blog
- [ ] Get exact Fabric Loader version for `gradle.properties` (check Maven for latest stable)

### NeoForge 1.21.1 Versions

**Truth Sources:**
- [NeoForge MDK-1.21.1-ModDevGradle](https://github.com/NeoForgeMDKs/MDK-1.21.1-ModDevGradle) — **PRIMARY SOURCE**
- [NeoForge Documentation](https://docs.neoforged.net/docs/1.21.1/gettingstarted/) — **Note:** Docs are flagged as "no longer actively maintained"; treat as secondary guidance only
- [NeoForge Maven Repository](https://maven.neoforged.net/releases/) for exact versions

**Known Information:**
- **Minecraft:** `1.21.1`
- **MDK Template:** Official `MDK-1.21.1-ModDevGradle` repository exists
  - Source: [GitHub NeoForgeMDKs](https://github.com/NeoForgeMDKs)

**Action Items:**
- [ ] Clone/download the official MDK-1.21.1-ModDevGradle template
- [ ] Extract property names from MDK's `gradle.properties` (may be `neo_version`, `neo_version_range`, `loader_version_range`, etc. — **match MDK exactly**)
- [ ] Extract exact version ranges from MDK's `META-INF/neoforge.mods.toml` (should be **bounded ranges** for LTS, e.g., `[21.1.0,21.2)` not `[21.1.0,)`)
- [ ] Copy exact property names and structure from MDK (don't assume `neoforge_version`/`moddevgradle_version` are standard)
- [ ] Verify NeoForge stable release (not beta) for 1.21.1

---

## Implementation Checklist

### Step 1: Verify Version Numbers

**Fabric:**
1. Check [Yarn Maven](https://maven.fabricmc.net/net/fabricmc/yarn/) for latest `1.21.1+build.X`
2. Confirm Loom version from Fabric blog/release notes
3. Check Fabric Loader latest stable version

**NeoForge:**
1. Clone/download [MDK-1.21.1-ModDevGradle](https://github.com/NeoForgeMDKs/MDK-1.21.1-ModDevGradle)
2. Read `gradle.properties` for property names (may be `neo_version`, `neo_version_range`, `loader_version_range`, etc. — **copy exact names**)
3. Read `META-INF/neoforge.mods.toml` for dependency version ranges:
   - Should be **bounded** for LTS (not open-ended)
   - May use properties (e.g., `${neo_version_range}`) or literal ranges
   - May include additional fields: `type`, `ordering`, `side`
4. Copy exact structure and all fields (don't simplify or invent TOML format)

### Step 2: Update Build Configuration

**Prerequisites:**
- [ ] Verify Java 21 toolchain is explicitly set in `build.gradle` (don't rely on system default)
- [ ] Confirm Loom version compatibility with Gradle version

**Files to Update:**

1. **`gradle.properties`** (create if missing or update):
   ```properties
   # Minecraft 1.21.1 versions
   minecraft_version=1.21.1
   fabric_loader_version=0.16.X  # EXACT version (Gradle needs this), check Maven for latest stable
   yarn_mappings=1.21.1+build.X  # Verify latest build number
   fabric_loom_version=1.6.X     # Verify exact version from Fabric blog
   
   # NeoForge properties - COPY EXACT NAMES FROM MDK
   # May be: neo_version, neo_version_range, loader_version_range, etc.
   # Do NOT assume "neoforge_version" or "moddevgradle_version" are standard
   # Extract from MDK's gradle.properties exactly as named
   ```

2. **`fabric/src/main/resources/fabric.mod.json`**:
   
   **(Doc-only; real JSON files cannot contain comments.)**
   
   ```json
   {
     "depends": {
       "fabricloader": ">=0.16.0",
       "minecraft": "1.21.1"
     }
   }
   ```
   
   **Critical:** The `>=0.16.0` pattern belongs **only in metadata** (`fabric.mod.json`). `gradle.properties` needs an exact version.

3. **`neoforge/src/main/resources/META-INF/neoforge.mods.toml`**:
   
   **Important:** MDK templates often include additional fields (`type`, `ordering`, `side`, etc.). Don't simplify — copy the exact dependency block structure from MDK.
   
   ```toml
   [[dependencies.xp_stream]]
   modId = "neoforge"
   mandatory = true
   versionRange = "${neo_version_range}"  # Use MDK's property if present, or exact bounded range
   # May also include: type, ordering, side - copy from MDK exactly
   
   [[dependencies.xp_stream]]
   modId = "minecraft"
   mandatory = true
   versionRange = "[1.21.1]"  # Change from [1.21.11]
   # May also include: type, ordering, side - copy from MDK exactly
   ```
   
   **Critical for LTS:** 
   - Use **bounded ranges** (not open-ended `[21.1.0,)`) to prevent future breaking changes
   - If MDK uses properties like `${neo_version_range}`, use the same property plumbing
   - If MDK uses literal ranges, copy the exact bounds (may differ from `[21.1.0,21.2)`)
   - Keep all fields MDK includes — don't remove `type`, `ordering`, `side` if present

### Step 3: Verify Mixin Targets

**Action Items:**
- [ ] Run `./gradlew :fabric:runClient` and check decompiled `ExperienceOrbEntity` for method name
- [ ] Run `./gradlew :neoforge:runClient` and check decompiled `ExperienceOrb` for method name
- [ ] If method names differ between 1.21.1 and 1.21.11, update mixin `method = "..."` strings
- [ ] Verify both mixins still delegate to shared `common/` logic
- [ ] **Critical:** Verify mixin actually changes behavior (not just "applies without error")
  - Run orb burst test and confirm collision behavior changed
  - Mixins can "apply" but miss the exact method signature if descriptors changed

**Expected Behavior:**
- Fabric: `onPlayerCollision(PlayerEntity player)` (Yarn)
- NeoForge: `playerTouch(Player player)` (Mojmap)
- Method names likely unchanged from 1.21.11, but **verify** (descriptors may differ)

### Step 4: Build & Test

**Build:**
```bash
./gradlew clean build
```

**Expected Outputs (with versioned naming):**
- `fabric/build/libs/xp_stream-fabric-1.21.1-0.2.0.jar`
- `neoforge/build/libs/xp_stream-neoforge-1.21.1-0.2.0.jar`

**Testing Checklist:**

**Fabric 1.21.1:**
- [ ] Mod loads without errors
- [ ] Mixin applies (check startup logs for mixin confirmation)
- [ ] Config loads from `config/xp_stream.json`
- [ ] Config writes defaults on first run, then reloads cleanly after restart
- [ ] Spawn 200 XP orbs, verify burst pickup works (behavior changed, not just "no crash")
- [ ] Verify Mending still repairs gear correctly
- [ ] Verify no XP loss (compare total XP before/after)

**NeoForge 1.21.1:**
- [ ] Mod loads without errors
- [ ] Mixin applies (check startup logs for mixin confirmation)
- [ ] Config loads from `config/xp_stream.json`
- [ ] Config writes defaults on first run, then reloads cleanly after restart
- [ ] Spawn 200 XP orbs, verify burst pickup works (behavior changed, not just "no crash")
- [ ] Verify Mending still repairs gear correctly
- [ ] Verify no XP loss (compare total XP before/after)

**Cross-Platform Verification:**
- [ ] Same behavior on Fabric and NeoForge
- [ ] Same config file format works on both loaders
- [ ] Config path and lifecycle consistent across loaders (both write to `config/xp_stream.json`)
- [ ] Performance characteristics match

### Step 5: Release Naming

**Required naming convention (to avoid user confusion):**
- `xp_stream-fabric-1.21.1-0.2.0.jar`
- `xp_stream-neoforge-1.21.1-0.2.0.jar`

**Why:** If mainline is also `0.2.0`, users will install the wrong version. Include Minecraft version in filename/release title.

**Implementation:** Update `build.gradle` `archivesName` or rename JARs after build, and use versioned release titles.

### Step 6: Tag & Release

```bash
git tag v0.2.0-1.21.1
git push origin maintenance/1.21.1 --tags
```

**Then leave the branch as-is.** No further maintenance planned.

---

## Potential Gotchas

### Fabric Loom Version
- **Solution:** Use Loom 1.6.x per Fabric's 1.21/1.21.1 guidance
- **Source:** [Fabric Blog](https://fabricmc.net/) recommendation for 1.21/1.21.1 generation
- **Action:** Follow Fabric guidance; don't speculate about Unpick versions

### NeoForge Stable vs Beta
- **Issue:** 1.21.11 uses `21.11.0-beta`, but 1.21.1 should have stable release
- **Solution:** Use stable NeoForge version from MDK (not beta)
- **Verify:** Check MDK template for exact version string

### Gradle & Java Toolchain Compatibility
- **Current:** Project uses Gradle 9.2.1 (for 1.21.11)
- **1.21.1:** May work with same Gradle, but verify if issues arise
- **Loom Version:** Loom 1.6.x expects specific Gradle range — verify compatibility
- **Java Toolchain:** Confirm Java 21 is explicitly set (don't rely on system default)
  - Check `build.gradle` Java toolchain configuration for both `fabric/` and `neoforge/` modules
  - Verify `java.toolchain.languageVersion = JavaLanguageVersion.of(21)` is present
- **Action:** Test build first, verify Java toolchain is explicit, adjust if needed

### Mixin Method Names
- **Likely:** Same as 1.21.11 (Yarn `onPlayerCollision`, Mojmap `playerTouch`)
- **Verify:** Always check decompiled classes in IDE after running client
- **Action:** If different, update mixin `method = "..."` strings

---

## Key Differences: 1.21.1 vs 1.21.11

| Aspect | 1.21.11 (Current) | 1.21.1 (Target) |
|--------|-------------------|-----------------|
| **Minecraft Version** | `1.21.11` | `1.21.1` |
| **Yarn Mappings** | `1.21.11+build.1` | `1.21.1+build.X` |
| **Fabric Loom** | `1.14.x` | `1.6.x` (per Fabric guidance) |
| **NeoForge Version** | `21.11.0-beta` | `21.1.XX` (stable) |
| **ModDevGradle** | Current version | May differ (check MDK) |
| **Mixin Methods** | Likely same | **Verify** |

---

## Estimated Timeline

- **Version Research:** 15-30 minutes (checking MDK and Maven repos)
- **File Updates:** 10-15 minutes
- **Build & Test:** 30-60 minutes (both loaders)
- **Total:** 1-2 hours

---

## Definition of Done

1. ✅ All version numbers verified from official sources (MDK, Maven, Fabric blog)
2. ✅ `gradle.properties` updated with correct versions
3. ✅ `fabric.mod.json` updated to `1.21.1`
4. ✅ `neoforge.mods.toml` updated to `1.21.1` with correct version ranges
5. ✅ Mixin targets verified (method names confirmed)
6. ✅ Both loaders build successfully
7. ✅ Both loaders tested and working (burst pickup, Mending, no XP loss)
8. ✅ Branch tagged and ready for release
9. ✅ Documentation updated (if needed)

---

## References

- [NeoForge MDK-1.21.1-ModDevGradle](https://github.com/NeoForgeMDKs/MDK-1.21.1-ModDevGradle) — **PRIMARY SOURCE**
- [NeoForge 1.21.1 Documentation](https://docs.neoforged.net/docs/1.21.1/gettingstarted/) — **Note:** Docs flagged as "no longer actively maintained"; use MDK as primary source
- [Fabric Maven Repository](https://maven.fabricmc.net/)
- [Fabric Loader Maven](https://maven.fabricmc.net/net/fabricmc/fabric-loader/)
- [Yarn Mappings Maven](https://maven.fabricmc.net/net/fabricmc/yarn/)
- [NeoForge Maven Repository](https://maven.neoforged.net/releases/)

---

## Status

| Task | Status |
|------|--------|
| Branch created | ✅ Complete |
| Version research | ⏳ In Progress |
| Build config updates | ⏳ Pending |
| Mixin verification | ⏳ Pending |
| Testing | ⏳ Pending |
| Release | ⏳ Pending |
